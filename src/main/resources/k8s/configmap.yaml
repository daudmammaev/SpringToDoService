apiVersion: v1
kind: ConfigMap
metadata:
  name: todo-app-config
  namespace: todo-app
data:
  APPLICATION_PROPERTIES: |
    # Server Configuration
    server.port=8080
    server.servlet.context-path=/
    
    # Spring Configuration
    spring.profiles.active=kubernetes
    spring.jackson.serialization.write-dates-as-timestamps=false
    spring.jackson.time-zone=Europe/Moscow
    
    # Database Configuration
    spring.datasource.url=jdbc:postgresql://postgres-service.todo-app.svc.cluster.local:5432/todo_db
    spring.datasource.driver-class-name=org.postgresql.Driver
    spring.datasource.hikari.maximum-pool-size=10
    spring.datasource.hikari.minimum-idle=2
    
    # JPA Configuration
    spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
    spring.jpa.hibernate.ddl-auto=validate
    spring.jpa.show-sql=false
    spring.jpa.properties.hibernate.format_sql=false
    
    # Liquibase Configuration
    spring.liquibase.enabled=true
    spring.liquibase.change-log=classpath:db/changelog/db.changelog-master.yaml
    spring.liquibase.contexts=kubernetes
    
    # Redis Configuration
    spring.redis.host=redis-service.todo-app.svc.cluster.local
    spring.redis.port=6379
    spring.redis.timeout=2000ms
    spring.redis.lettuce.pool.max-active=8
    spring.redis.lettuce.pool.max-idle=8
    spring.redis.lettuce.pool.min-idle=2
    
    # Cache Configuration
    spring.cache.type=redis
    spring.cache.redis.time-to-live=300000
    spring.cache.redis.key-prefix=todo_prod_
    spring.cache.redis.cache-null-values=false
    spring.cache.redis.use-key-prefix=true
    
    # Logging Configuration
    logging.level.com.example.todo=INFO
    logging.level.org.springframework.web=INFO
    logging.level.org.hibernate=WARN
    logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n
    
    # Security (for production)
    management.endpoints.web.exposure.include=health,info,metrics
    management.endpoint.health.show-details=always

  LIQUIBASE_PROPERTIES: |
    changelog-file: db/changelog/db.changelog-master.yaml
    contexts: kubernetes
    default-schema: public
    driver: org.postgresql.Driver
    url: jdbc:postgresql://postgres-service.todo-app.svc.cluster.local:5432/todo_db